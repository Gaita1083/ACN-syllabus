# helmrelease-ingress
This is the content of helmrelease-ingress.

# 4.1.9 Helmrelease ingress

To start let's create folders and files for each release

```
|-- infrastructure
|   |-- ingress
|   |   |-- kustomization.yaml
|   |   |-- kustomizeconfig.yaml
|   |   |-- release.yaml
|   |   |-- values.yaml
|   |   |-- namespace.yaml
|   |   |-- issuer.yaml
```

```
# infrastructure/ingress/kustomization.yaml
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: ingress
resources:
  - namespace.yaml
  - release.yaml
configMapGenerator:
  - name: values
    files:
      - values.yaml=values.yaml
configurations:
  - kustomizeconfig.yaml
```

```
# infrastructure/cert-manager/kuztomizeconfig.yaml
---
# Kustomize config for enabling HelmRelease values from
# ConfigMaps and Secrets generated by Kustomize
nameReference:
- kind: ConfigMap
  version: v1
  fieldSpecs:
  - path: spec/valuesFrom/name
    kind: HelmRelease
```

```
# infrastructure/cert-manager/release.yaml
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: ingress-nginx
spec:
  releaseName: ingress-nginx
  chart:
    spec:
      chart: ingress-nginx
      sourceRef:
        kind: HelmRepository
        name: ingress-nginx
        namespace: flux-system
      version: "*"
  interval: 24h0m0s
  install:
    remediation:
      retries: 3
  valuesFrom:
    - kind: ConfigMap
      name: values
```

```
# infrastructure/ingress/namespace.yaml
---
apiVersion: v1
kind: Namespace
metadata:
  name: ingress
```

```
# infrastructure/ingress/values.yaml
---
controller:
  admissionWebhooks:
    certManager:
      enabled: "true"
  service:
    externalIPs: ["129.151.165.195"] # replace with your ip address

```



Now remember to add the folder in the infrastructure kustomization

```
# infrastructure/kustomization.yaml
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - sources
  - cert-manager
  - ingress
```

git push to your main branch and you should notice the containers rollout in cert-manager namespace

```
kubectl -n ingress get pods
kubectl -n ingress get svc
kubectl -n flux-system get helmchart
```
